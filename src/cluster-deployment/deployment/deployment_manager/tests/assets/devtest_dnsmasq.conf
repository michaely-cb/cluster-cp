# Generated by deployment-manager
# Do not edit this file! Changes will be overwritten.
# Instead, add a file such as /etc/dnsmasq.d/cluster.conf if
# customization for this cluster is needed.

# do not forward AAAA or A queries for host lookups
domain-needed

# do not forward reverse dns queries for private ranges if not found in /etc/hosts
bogus-priv

# upstream DNS servers
server=172.28.243.5
server=172.28.243.6

# do not forward requests for queries in cerebras.internal, only serve locally from /etc/hosts and hosts entries
local=/cerebras.internal/

# only accept dns requests from IPs on a network for one of dnsmasq's interfaces
local-service


# in addition to the interface, we need to listen on the IP address since
# locally running k8 pods do not send traffic on the interface
listen-address=172.28.8.19

# restrict dhcp requests to requesting names in cerebras.internal
domain=cerebras.internal

# limit the maximum number of leases issued
dhcp-lease-max=5000

expand-hosts

# allow additional configs
conf-dir=/etc/dnsmasq.d

# allow specifying hosts without modifying system's /etc/hosts file
hostsdir=/etc/hosts.d

# tag cerebras MAC pattern as cs2
dhcp-mac=set:cs2,70:55:f8:*:*:*

# static configs for pxe chainloading
dhcp-match=set:ipxe,175
dhcp-option=tag:type_sr,tag:!ipxe,67,"undionly.kkpxe"
dhcp-option=tag:type_sr,tag:ipxe,67,"boot-rocky.ipxe"

### tftp ###
enable-tftp
tftp-root=/var/ftpd

### global dhcp options ###
dhcp-option=6,172.28.8.19  # dns
dhcp-option=42,172.28.8.19  # ntp
dhcp-option=66,172.28.8.19  # tftp


### subnets ###

# subnet subnet0
dhcp-range=set:subnet0,172.28.8.0,static,255.255.255.0,2400
dhcp-option=tag:subnet0,3,172.28.8.254  # gateway
dhcp-host=set:type_sr,3c:ec:ef:6f:ad:38,172.28.8.132,sc-r1rb1-s5-ipmi
dhcp-host=set:type_sr,3c:ec:ef:6f:ac:8a,172.28.8.20,sc-r1rb1-s5
dhcp-host=set:type_sr,3c:ec:ef:6f:ad:3d,172.28.8.133,sc-r1rb1-s6-ipmi
dhcp-host=set:type_sr,3c:ec:ef:6f:ac:92,172.28.8.21,sc-r1rb1-s6
dhcp-host=set:type_sr,3c:ec:ef:7a:a8:06,172.28.8.134,sc-r1rb1-s7-ipmi
dhcp-host=set:type_sr,3c:ec:ef:7a:a5:6a,172.28.8.22,sc-r1rb1-s7
dhcp-host=set:type_sr,3c:ec:ef:77:54:42,172.28.8.135,sc-r1rb1-s8-ipmi
dhcp-host=set:type_sr,3c:ec:ef:77:52:c4,172.28.8.23,sc-r1rb1-s8
dhcp-host=set:type_sy,tag:cs2,70:55:f8:*:*:*,172.28.8.122
