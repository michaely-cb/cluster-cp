hostname ${switch_name}
! clear default login banner
no banner login
username admin role network-admin secret sha512 ${switch_sha}

! support special cerebras qualified transceivers
service unsupported-transceiver Cerebras 8f23e7db

!
vlan ${mgmt_vlan}
!

interface Ethernet 1
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 2
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 3
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 4
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 5
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 6
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 7
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 8
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 9
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 10
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 11
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 12
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 13
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 14
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 15
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 16
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 17
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 18
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 19
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 20
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 21
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 22
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 23
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 24
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 25
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 26
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 27
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 28
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 29
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 30
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 31
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 32
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 33
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 34
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 35
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 36
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 37
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 38
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 39
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 40
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 41
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 42
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 43
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 44
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 45
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 46
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 47
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 48
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 51
   description management node 10G
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 52
   description management node 10G
   switchport
   switchport access vlan ${mgmt_vlan}

interface Ethernet 49
   description uplink to aggregate switch
   no switchport
   ipv6 enable
   ipv6 address auto-config
!
interface Ethernet 50
   description uplink to aggregate switch
   no switchport
   ipv6 enable
   ipv6 address auto-config
!
interface Loopback0
   ip address ${loopback_ip}/32 
!
interface Vlan${mgmt_vlan}
   ip address ${switch_cidr}
   ip helper-address ${ip_helper_address}
!
vrf instance mgmt
interface Management1
   vrf mgmt
   ip address ${switch_mgmt_cidr}
!
ip route vrf mgmt 0.0.0.0/0 ${switch_mgmt_gw}
!
ip routing ipv6 interfaces
!
ipv6 unicast-routing
!
peer-filter peer-as
   10 match as-range 1-4294967295 result accept
!
router bgp ${switch_asn}
   ! TODO test encrypted version in the config "neighbor mgmt-node or agg-sw password 0 cerebras"
   router-id ${loopback_ip}
   bgp default ipv4-unicast transport ipv6
   maximum-path 64 ecmp 64
   neighbor mgmt-node peer group
   neighbor mgmt-node timers 5 15
   neighbor mgmt-node maximum-routes 12000
   neighbor mgmt-node local-as ${local_asn} no-prepend replace-as
   !
   neighbor agg-sw peer group
   neighbor agg-sw maximum-routes 12000
   redistribute connected
   ! range is the whole mgmt pool so we don't need to manage IP
   bgp listen range ${mgmt_subnet} peer-group mgmt-node peer-filter peer-as
   !
   ! peer with agg switches, remote-as is the agg switch ASN
   neighbor interface Et49 peer-group agg-sw remote-as ${asn_agg_0}
   neighbor interface Et50 peer-group agg-sw remote-as ${asn_agg_1}
   !
   address-family ipv4
      neighbor agg-sw activate
      neighbor agg-sw next-hop address-family ipv6 originate
!

end