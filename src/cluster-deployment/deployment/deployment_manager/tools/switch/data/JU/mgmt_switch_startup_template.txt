groups {
    global {
        interfaces {
            lo0 {
                unit 0 {
                    family inet {
                        address ${loopback_ip}/32;
                    }
                }
            }
        }
    }
}
system {
    host-name ${switch_name};
    root-authentication {
        encrypted-password "$$6$$cj/a3cFy$$o/cC6MFxXlY8z1PyLgeB/VIC0xjJsfkaETWFUr0zrJDFFMMNjUBxdV2Ebk4zlROl71h8mDszm9KQ6QJE2ZhhD1"; ## SECRET-DATA
    }
    login {
        user admin {
            uid 2000;
            class super-user;
            authentication {
                encrypted-password "$$6$$QhIj8lXH$$fVVnSDPAzsl5x6/80sUo0TF7SNba87rc76nR4svQiDxk7sa/MQGzsybzypqK2SDgCKliAitEZmXuyUkyys2f//"; ## SECRET-DATA
            }
        }
    }
    services {
        ssh;
    }
    management-instance;
}
interfaces {
    ge-0/0/0 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/1 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/2 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/3 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/4 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/5 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/6 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/7 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/8 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/9 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/10 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/11 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/12 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/13 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/14 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/15 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/16 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/17 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/18 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/19 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/20 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/21 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/22 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/23 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/24 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/25 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/26 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/27 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/28 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/29 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/30 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/31 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/32 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/33 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/34 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/35 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/36 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/37 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/38 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/39 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/40 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/41 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/42 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/43 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/44 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/45 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/46 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    ge-0/0/47 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    xe-0/2/0 {
        unit 0 {
            family inet;
            family inet6;
        }
    }
    xe-0/2/1 {
        unit 0 {
            family inet;
            family inet6;
        }
    }
    xe-0/2/2 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    xe-0/2/3 {
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members vlan${mgmt_vlan};
                }
            }
        }
    }
    irb {
        unit ${mgmt_vlan} {
            family inet {
                address ${switch_cidr};
            }
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address ${loopback_ip}/32;
            }
        }
    }
    vme {
        mtu 1500;
        unit 0 {
            family inet {
                address ${switch_mgmt_cidr};
            }
        }
    }
}
forwarding-options {
    dhcp-relay {
        forward-only;
        server-group {
            dhcp-servers-group {
                ${ip_helper_address};
            }
        }
        active-server-group dhcp-servers-group;
        group dhcp {
            interface irb.${mgmt_vlan};
        }
    }
}
policy-options {
    policy-statement connected {
        term 1 {
            from protocol direct;
            then accept;
        }
    }
    policy-statement lb {
        then {
            load-balance per-flow;
        }
    }
    as-list all-asn members 1-4294967295;
}
routing-instances {
    mgmt_junos {
      routing-options {
        static {
            route 0.0.0.0/0 next-hop ${switch_mgmt_gw};
        }
      }
      description "mgmt vrf";
    }
}
routing-options {
    autonomous-system ${switch_asn};
    forwarding-table {
        export lb;
    }
}
protocols {
    lldp {
        port-id-subtype interface-name;
        interface all;
    }
    router-advertisement {
        interface xe-0/2/0.0;
        interface xe-0/2/1.0;
    }
    bgp {
        group agg-sw {
            type external;
            family inet {
                unicast {
                    extended-nexthop;
                }
            }
            export connected;
            dynamic-neighbor agg-sw {
                peer-auto-discovery {
                    family inet6 {
                        ipv6-nd;
                    }
                    interface xe-0/2/0.0;
                    interface xe-0/2/1.0;
                }
            }
            peer-as-list all-asn;
        }
        group mgmt-node {
            type external;
            hold-time 15;
            family inet {
                unicast {
                    prefix-limit {
                        maximum 12000;
                    }
                }
            }
            peer-as ${mgmt_node_asn};
            local-as ${local_asn} private no-prepend-global-as;
            dynamic-neighbor mgmt-nodes {
                allow ${mgmt_subnet};
            }
        }
    }
}
vlans {
    vlan${mgmt_vlan} {
        vlan-id ${mgmt_vlan};
        l3-interface irb.${mgmt_vlan};
    }
}
