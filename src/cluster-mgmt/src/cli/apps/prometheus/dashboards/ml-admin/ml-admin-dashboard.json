{
   "annotations": {
      "list": [ ]
   },
   "editable": false,
   "gnetId": null,
   "graphTooltip": 1,
   "hideControls": false,
   "links": [ ],
   "panels": [
      {
         "collapsed": false,
         "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 0
         },
         "type": "row"
      },
      {
         "datasource": "$datasource",
         "description": "Systems status at the last timestamp of the selected range.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "green",
                  "mode": "fixed"
               },
               "custom": {
                  "drawStyle": "line",
                  "fillOpacity": 1,
                  "lineWidth": 1,
                  "pointSize": 5,
                  "showPoints": "never",
                  "spanNulls": false,
                  "stacking": {
                     "group": "A",
                     "mode": "none"
                  }
               },
               "decimals": "auto",
               "thresholds": {
                  "mode": "absolute",
                  "steps": [ ]
               },
               "unit": "short"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byName",
                     "options": "Utilized Percent"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "percent"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 9,
            "w": 24
         },
         "links": [ ],
         "options": {
            "graphMode": "none",
            "justifyMode": "center",
            "legend": {
               "showLegend": true
            },
            "tooltip": {
               "mode": "single",
               "sort": "none"
            }
         },
         "targets": [
            {
               "expr": "sum((max(system_overall_health) by (system)) * on (system) group_left group by (system) (namespace_reserved_system{namespace=~\"$namespace\"}) == bool 1) + sum((max(system_overall_health) by (system)) * on (system) group_left group by (system) (namespace_reserved_system{namespace=~\"$namespace\"}) == bool 2)",
               "format": "time_series",
               "legendFormat": "Available",
               "legendLink": null
            },
            {
               "expr": "clamp_max(avg_over_time((sum((group(wsjob_system_grant{namespace=~\"$namespace\"}) by (system)) or (sum(0*system_label) by (system))) / count(group(namespace_reserved_system{namespace=~\"$namespace\"}) by (system)))[$__range:$__rate_interval]) *100, 100)",
               "format": "time_series",
               "legendFormat": "Utilized Percent",
               "legendLink": null
            },
            {
               "expr": "avg_over_time((sum(group(wsjob_system_grant{namespace=~\"$namespace\"}) by (system)) or sum(sum(system_label*0) by (system)))[$__range:$__rate_interval]) * (${__to:date:seconds}-${__from:date:seconds})/3600",
               "format": "time_series",
               "legendFormat": "Utilized Hours",
               "legendLink": null
            }
         ],
         "title": "CS2 Overall Status",
         "type": "stat"
      },
      {
         "datasource": "$datasource",
         "description": "(Max) Number of systems used by jobs",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "mode": "palette-classic"
               },
               "custom": {
                  "drawStyle": "line",
                  "fillOpacity": 100,
                  "lineInterpolation": "stepBefore",
                  "lineWidth": 0,
                  "pointSize": 5,
                  "showPoints": "never",
                  "spanNulls": false,
                  "stacking": {
                     "group": "A",
                     "mode": "normal"
                  }
               },
               "decimals": 0,
               "min": 0,
               "thresholds": {
                  "mode": "absolute",
                  "steps": [ ]
               },
               "unit": "none"
            },
            "overrides": [ ]
         },
         "gridPos": {
            "h": 11,
            "w": 24
         },
         "links": [ ],
         "options": {
            "legend": {
               "calcs": [
                  "max"
               ],
               "displayMode": "table",
               "placement": "right",
               "showLegend": true,
               "sortBy": "Max",
               "sortDesc": true
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "targets": [
            {
               "expr": "count by (name, labels_k8s_cerebras_com_Model) (group by (name, system) (wsjob_system_grant{namespace=~\"$namespace\"})) * on (name) group_left(labels_k8s_cerebras_com_Model) group by(name, labels_k8s_cerebras_com_Model) (wsjob_annotation{job_type!=\"compile\", namespace=~\"$namespace\"})",
               "format": "time_series",
               "legendFormat": "{{labels_k8s_cerebras_com_Model}} / {{name}}",
               "legendLink": null
            }
         ],
         "title": "CS2 Jobs Histogram",
         "type": "timeseries"
      }
   ],
   "refresh": "",
   "rows": [ ],
   "schemaVersion": 14,
   "style": "dark",
   "tags": [
      "cluster-mgmt"
   ],
   "templating": {
      "list": [
         {
            "current": {
               "text": "default",
               "value": "default"
            },
            "hide": 2,
            "label": "Data Source",
            "name": "datasource",
            "query": "prometheus",
            "refresh": 1,
            "type": "datasource"
         },
         {
            "allValue": ".*",
            "current": { },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": true,
            "label": null,
            "multi": false,
            "name": "namespace",
            "options": [ ],
            "query": "label_values(namespace_reservation, namespace)",
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "tagValuesQuery": "",
            "tags": [ ],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
         }
      ]
   },
   "time": {
      "from": "now-24h",
      "to": "now"
   },
   "timepicker": {
      "refresh_intervals": [
         "5s",
         "10s",
         "30s",
         "1m",
         "5m",
         "15m",
         "30m",
         "1h",
         "2h",
         "1d"
      ],
      "time_options": [
         "5m",
         "15m",
         "1h",
         "6h",
         "12h",
         "24h",
         "2d",
         "7d",
         "30d"
      ]
   },
   "timezone": "",
   "title": "ML Admin Dashboard",
   "uid": "IsU0ZxuVz",
   "version": 0
}
